// -*- mode: js2 -*-
require("clicks-in-new-buffer.js");
require('eye-guide.js');
require('new-tabs.js');
require("page-modes/google-search-results.js");
require("block-content-focus-change.js");

external_content_handlers = { "*": "/home/abesto/bin/mimeoc", };
//url_remoting_fn = load_url_in_new_buffer

// JQuery
function install_jquery(d) {
    var script_el = d.createElementNS(XHTML_NS, "script");
    script_el.setAttribute("language", "javascript");
    script_el.setAttribute("type", "text/javascript");
    script_el.setAttribute("src", "http://ajax.googleapis.com/ajax/libs/jquery/1.3.2/jquery.min.js");
    d.body.appendChild(script_el);
}

function jquery_this_doc(d, js_code) {
    install_jquery(d);
    var script_el = d.createElementNS(XHTML_NS, "script");
    script_el.textContent = js_code;
    d.body.appendChild(script_el);
}

interactive("jquery-here",
            "load jquery.js into this page, then your command",
            function(I) {
                jquery_this_doc(I.buffer.document, (yield I.minibuffer.read($prompt = "jq: ", $history = "jquery-here")));
                // Providing a $history is what allows editing/replay of earlier commands
            });

clicks_in_new_buffer_target = OPEN_NEW_BUFFER_BACKGROUND;
can_kill_last_buffer = false;
editor_shell_command = "emacsclient -c";
hints_auto_exit_delay = 1;
//download_buffer_automatic_open_target = [OPEN_NEW_BUFFER_BACKGROUND, OPEN_NEW_WINDOW];

xkcd_add_title = true;

google_search_bind_number_shortcuts();
// override google-search-results mode keybindings for navigation
var i;
var gs_maps = Array(
    "j"   , "cmd_scrollLineDown",
    "k"   , "cmd_scrollLineUp",
    "o"   , "find-url",
    "/"   , "isearch-forward"
);
for (i = 0; i < gs_maps.length; i += 2)
    define_key(google_search_results_keymap, gs_maps[i], gs_maps[i+1]);


// Keybindings
var maps = Array(
    // Vimperator-like
    "j"   , "cmd_scrollLineDown",
    "k"   , "cmd_scrollLineUp",
    "h"   , "cmd_scrollLeft",
    "l"   , "cmd_scrollRight",
    "o"   , "find-url",
    "F"   , "follow-new-buffer",
    "t"   , "find-url-new-buffer",
    "C-i" , "forward",
    "C-o" , "back",
    "C-n" , "buffer-next",
    "C-p" , "buffer-previous",
    "d"   , "kill-current-buffer",
    "/"   , "isearch-forward",
    'y'   , "copy",
    // Eye guide
    "space", "eye-guide-scroll-down",
    "back_space", "eye-guide-scroll-up",
    // Vimperator-like eye guide :D
    "C-f" , "eye-guide-scroll-down",
    "C-b" , "eye-guide-scroll-up"
);

for (i = 0; i < maps.length; i += 2)
    define_key(content_buffer_normal_keymap, maps[i], maps[i+1]);

define_webjump("archwiki", "http://wiki.archlinux.org/index.php?title=Special%3ASearch&ns0=1&search=%s&fulltext=Advanced+search");
